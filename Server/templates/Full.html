<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>
  <!--HandsOnTable-->
  <script src='/jquery/jquery-3.3.1.min.js'></script>
  <script src='/handsontable/dist/handsontable.full.js'></script>
  <script src='/bootstrap/3.3.7/js/bootstrap.min.js'></script>
  <link rel='stylesheet' href='/bootstrap/3.3.7/css/bootstrap.min.css'>
  <link rel='stylesheet' href='/bootstrap/3.3.7/css/bootstrap-theme.min.css'>
  <!--<script src='https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js'></script>-->
  <!--<link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css'>-->
  <!--<link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap-theme.min.css'>-->
  <link rel='stylesheet' media='screen' href='/handsontable/dist/handsontable.full.css'>
  <link rel='stylesheet' href='/default.css'>

  <!--Floara Editor-->
  <meta name='viewport' content='width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0' />
  <script type='text/javascript' src='/jquery.min.js'></script>
  <link rel='stylesheet' href='/font-awesome.min.css'>
  <link rel='stylesheet' href='/froala_editor/css/froala_editor.css'>
  <link rel='stylesheet' href='/froala_editor/css/froala_style.css'>
  <link rel='stylesheet' href='/froala_editor/css/plugins/code_view.css'>
  <link rel='stylesheet' href='/froala_editor/css/plugins/draggable.css'>
  <link rel='stylesheet' href='/froala_editor/css/plugins/colors.css'>
  <link rel='stylesheet' href='/froala_editor/css/plugins/emoticons.css'>
  <link rel='stylesheet' href='/froala_editor/css/plugins/image_manager.css'>
  <link rel='stylesheet' href='/froala_editor/css/plugins/image.css'>
  <link rel='stylesheet' href='/froala_editor/css/plugins/line_breaker.css'>
  <link rel='stylesheet' href='/froala_editor/css/plugins/table.css'>
  <link rel='stylesheet' href='/froala_editor/css/plugins/char_counter.css'>
  <link rel='stylesheet' href='/froala_editor/css/plugins/video.css'>
  <link rel='stylesheet' href='/froala_editor/css/plugins/fullscreen.css'>
  <link rel='stylesheet' href='/froala_editor/css/plugins/file.css'>
  <link rel='stylesheet' href='/froala_editor/css/plugins/quick_insert.css'>
  <link rel='stylesheet' href='/froala_editor/css/plugins/help.css'>
  <link rel='stylesheet' href='/froala_editor/css/third_party/spell_checker.css'>
  <link rel='stylesheet' href='/froala_editor/css/plugins/special_characters.css'>
</head>

<body>

  <!--<div id='HELP'>
    <img src='./help.png'>
  </div>-->

  <div id='LEFT_OVER' class='LEFT_Overlay'></div>
  <div id='RIGHT_OVER' class='RIGHT_Overlay'></div>
  <div id='FULL_OVER' class='FULL_Overlay'></div>

  <div id='LEFT' class='LEFT'>
    <div id='List_Left'></div>
  </div>
  <div id='RIGHT' class='RIGHT_LINK'>
    <div id='List_Right'></div>
  </div>

  <div id='START'>
    <div id='JOBS'></div>
    <div id='LAST'></div>
  </div>

  <div id='BOTTOM'></div>

  <div id='USER'></div>
  <div id='LOG'></div>
  <div id='MODESTATE'></div>
  <div id="SEARCH">
    <div id="SEARCH_CONTENT">
      <div id="SEARCH_HEADER">
        <span class="close" onclick='javascript:(function() {$("#SEARCH").hide();})()'>&times;</span>
        <h5>Search Text in Items...</h5>
      </div>
      <div id="SEARCH_BODY">
        <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:10%'> Document
        </div><select id='DOCUMENT' style='display:iniline-block;float:left;vertical-align:top;height:25px;width:8%'>
          <option value=-1>All</option>
          <option value=0>SSS</option>
          <option value=1>SRS</option>
          <option value=2>STD</option>
          <option value=3>STR</option>
        </select>
        <div class='shade'
          style='display:iniline-block;float:left;text-align:center;vertical-align:top;height:25px;width:11%'>
          Component</div><select id='COMPONENT'
          style='display:iniline-block;float:left;vertical-align:top;height:25px;width:42%'></select>
        <div class='shade'
          style='display:iniline-block;float: left;text-align:center;vertical-align:top;height:25px;width:10%'>
          Category</div><select id='CATEGORY'
          style='display:iniline-block;float:left;vertical-align:top;height:25px;width:19%'>
          <option value=-1>All</option>
          <option value=0>Identifier</option>
          <option value=1>Title/Requirement</option>
          <option value=2>Description</option>
        </select>
        <br>
        <div class='shade'
          style='display:iniline-block;float: left;text-align:center;vertical-align:top;height:25px;width:5%'>Text</div>
        <input id="text" type='text'
          style='display:iniline-block;float: center;vertical-align:top;height:25px;width:95%' autofocus>
        <br><br><button style='float:right' onClick="Search()">Search</button><br>
      </div>
    </div>
  </div>
  <!-- VIEWs-->
  <!-- Document Item 0-->
  <div id='VIEW_TYPE0' class='RIGHT' hidden>
    <div id='VIEW_TYPE0_DOCUMENT' class='shade'
      style='display:iniline-block;float:left;text-align:center;height:25px;width:20%'> Document</div>
    <div id='VIEW_TYPE0_CSCI' class='shade'
      style='display:iniline-block;float:left;text-align:center;height:25px;width:50%'>CSCI</div>
    <div id='VIEW_TYPE0_UID' class='shade'
      style='display:iniline-block;float:left;text-align:center;height:25px;width:30%'>123</div><br>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:20%'>장/절 제목</div>
    <select id='VIEW_TYPE0_RID1' style='display:iniline-block;float:left;vertical-align:top;height:25px;width:15%'>
      <option value='1.'>1.</option>
      <option value='1.1.'>1.1.</option>
      <option value='1.1.1.'>1.1.1.</option>
      <option value='1.1.1.1.'>1.1.1.1.</option>
      <option value='1.1.1.1.1.'>1.1.1.1.1.</option>
      <option value='1.1.1.1.1.1.'>1.1.1.1.1.1.</option>
      <option value='1.1.1.1.1.1.1.'>1.1.1.1.1.1.1.</option>
      <option value='1.1.1.1.1.1.1.1.'>1.1.1.1.1.1.1.1.</option>
      <option value='1.1.1.1.1.1.1.1.1.'>1.1.1.1.1.1.1.1.1.</option>
    </select>
    <input id='VIEW_TYPE0_TITLE' type='text'
      style='display:iniline-block;float:left;vertical-align:top;height:25px;width:65%'><br>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:100%'>내용</div>
    <br><br>
    <textarea id='VIEW_TYPE0_FLOEDIT'></textarea>
    <div class='center' style='float:center; border: 2px solid #48BAE4; width:700px; height: 2px;'></div>
    <center><button id='VIEW_TYPE0_SAVE' onclick='Save(0)'>Save</button></center>
    <center> <button id='VIEW_TYPE0_REVIEW' onclick='Review(0)'>Review</button> </center>
  </div>
  <!-- SSS REQ Item 1-->
  <div id='VIEW_TYPE1' class='RIGHT' hidden>
    <div id='VIEW_TYPE1_DOCUMENT' class='shade'
      style='display:iniline-block;float:left;text-align:center;height:25px;width:50%'>SRS</div>

    <div id='VIEW_TYPE1_UID' class='shade'
      style='display:iniline-block;float:left;text-align:center;height:25px;width:50%'></div><br>


    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:20%'>요구사항식별자</div>
    <div id='VIEW_TYPE1_RID1' style='display:iniline-block;float:left;text-align:center;height:25px;width:20%'></div>
    <input type='text' id='VIEW_TYPE1_RID2'
      style='display:iniline-block;float:left;text-align:center;height:25px;width:60%'>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:100%'>요구사항</div><br>
    <textarea id='VIEW_TYPE1_TITLE' style='width:100%;height:60px'></textarea><BR>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:100%'>설명</div><br>
    <textarea id='VIEW_TYPE1_FLOEDIT'></textarea>
    <div style='float:left; border: 2px solid #48BAE4; width:700px; height: 2px;'></div><BR>
    <center> <button id='VIEW_TYPE1_SAVE' onclick='Save(1)'>Save</button> </center>
    <center> <button id='VIEW_TYPE1_REVIW' onclick='Review(1)'>Review</button> </center>
  </div>

  <!-- SRS REQ Item 11-->
  <div id='VIEW_TYPE11' class='RIGHT' hidden>
    <div id='VIEW_TYPE11_DOCUMENT' class='shade'
      style='display:iniline-block;float:left;text-align:center;height:25px;width:20%'>SRS</div>
    <div id='VIEW_TYPE11_CSCI' class='shade'
      style='display:iniline-block;float:left;text-align:center;height:25px;width:50%'>CSCI</div>
    <div id='VIEW_TYPE11_UID' class='shade'
      style='display:iniline-block;float:left;text-align:center;height:25px;width:30%'></div><br>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:20%'>요구사항식별자</div>
    <div id='VIEW_TYPE11_RID1' style='display:iniline-block;float:left;text-align:center;height:25px;width:5%'></div>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:2%'>-</div>
    <div id='VIEW_TYPE11_RID2' style='display:iniline-block;float:left;text-align:center;height:25px;width:18%'></div>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:2%'>-</div>
    <select id='VIEW_TYPE11_RID3' style='display:iniline-block;float:left;text-align:center;height:25px;width:11%'
      onchange='viewChange()'>
      <option value='SFR'>SFR</option>
      <option value='IDR'>IDR</option>
      <option value='SSR'>SSR</option>
      <option value='ECRR'>ECRR</option>
      <option value='SQR'>SQR</option>
      <option value='ETR'>ETR</option>
      <option value='UC'>UseCase</option>
    </select>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:2%'>-</div>
    <input type='text' id='VIEW_TYPE11_RID4' style='display:iniline-block;float:left;text-align:center;height:25px;width:10%'>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:15%'>시험방법</div>
    <select id='VIEW_TYPE11_TESTTYPE' style='display:iniline-block;float:left;text-align:center;height:25px;width:15%'>
      <option value='0'>데모</option>
      <option value='1'>시험</option>
      <option value='2'>분석</option>
      <option value='3'>검사</option>
      <option value='4'>특수</option>
    </select>
    <br>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:100%'>요구사항</div><br>
    <textarea id='VIEW_TYPE11_TITLE' style='width:100%;height:60px'></textarea><BR>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:100%'>출처</div><br>
    <textarea id='VIEW_TYPE11_SOURCE' style='width:100%;height:30px'></textarea><BR>
    <div id='VIEW_TYPE11_USECASE_LABEL' class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:100%'>관련 Use Case</div><br>
    <textarea id='VIEW_TYPE11_USECASE' style='width:100%;height:30px'></textarea><BR>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:100%'>설명</div><br>
    <textarea id='VIEW_TYPE11_FLOEDIT' style='width:100%;height:100%'></textarea>
    <div style='float:left; border: 2px solid #48BAE4; width:700px; height: 2px;'></div><BR>
    <center> <button id='VIEW_TYPE11_SAVE' onclick='Save(11)'>Save</button> </center>
    <center> <button id='VIEW_TYPE11_REVIEW' onclick='Review(11)'>Review</button> </center>
  </div>

  <!-- SRS UC Item 12-->
  <div id='VIEW_TYPE12' class='RIGHT' hidden>
    <div id='VIEW_TYPE12_DOCUMENT' class='shade'
      style='display:iniline-block;float:left;text-align:center;height:25px;width:20%'>SRS</div>
    <div id='VIEW_TYPE12_CSCI' class='shade'
      style='display:iniline-block;float:left;text-align:center;height:25px;width:50%'>CSCI</div>
    <div id='VIEW_TYPE12_UID' class='shade'
      style='display:iniline-block;float:left;text-align:center;height:25px;width:30%'></div><br>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:20%'>UseCase 식별자</div>
    <div id='VIEW_TYPE12_RID1' style='display:iniline-block;float:left;text-align:center;height:25px;width:5%'></div>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:2%'>-</div>
    <div id='VIEW_TYPE12_RID2' style='display:iniline-block;float:left;text-align:center;height:25px;width:18%'></div>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:2%'>-</div>
    <select id='VIEW_TYPE12_RID3' style='display:iniline-block;float:left;text-align:center;height:25px;width:11%'
      onchange='viewChange()'>
      <option value='SFR'>SFR</option>
      <option value='IDR'>IDR</option>
      <option value='SSR'>SSR</option>
      <option value='ECRR'>ECRR</option>
      <option value='SQR'>SQR</option>
      <option value='ETR'>ETR</option>
      <option value='UC'>UseCase</option>
    </select>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:2%'>-</div>
    <input type='text' id='VIEW_TYPE12_RID4' style='display:iniline-block;float:left;text-align:center;height:25px;width:40%'>
    <br>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:20%'>Use Case 명</div>
    <input id='VIEW_TYPE12_TITLE' type='text' style='display:iniline-block;float:left;vertical-align:top;height:25px;width:80%'><br>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:100%'>내용</div>
    <br><br>
    <textarea id='VIEW_TYPE12_FLOEDIT' style='width:100%;height:100%'></textarea>
    <div style='float:left; border: 2px solid #48BAE4; width:700px; height: 2px;'></div><BR>
    <center> <button id='VIEW_TYPE12_SAVE' onclick='Save(12)'>Save</button> </center>
    <center> <button id='VIEW_TYPE12_REVIEW' onclick='Review(12)'>Review</button> </center>
  </div>

  <!-- SDD REQ Item 21-->
  <div id='VIEW_TYPE21' class='RIGHT' hidden>

    <div id='VIEW_TYPE21_DOCUMENT' class='shade'
      style='display:iniline-block;float:left;text-align:center;height:25px;width:20%'>SDD</div>
    <div id='VIEW_TYPE21_CSCI' class='shade'
      style='display:iniline-block;float:left;text-align:center;height:25px;width:50%'>CSCI</div>
    <div id='VIEW_TYPE21_UID' class='shade'
      style='display:iniline-block;float:left;text-align:center;height:25px;width:30%'></div><br>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:20%'>요구사항식별자</div>
    <div id='VIEW_TYPE21_RID1' style='display:iniline-block;float:left;text-align:center;height:25px;width:5%'></div>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:2%'>-</div>
    <div id='VIEW_TYPE21_RID2' style='display:iniline-block;float:left;text-align:center;height:25px;width:18%'></div>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:2%'>-</div>
    <select id='VIEW_TYPE21_RID3' style='display:iniline-block;float:left;text-align:center;height:25px;width:11%'
      onchange='viewChange()'>
      <option value='SFR'>SFR</option>
      <option value='IDR'>IDR</option>
      <option value='SSR'>SSR</option>
      <option value='ECRR'>ECRR</option>
      <option value='SQR'>SQR</option>
      <option value='ETR'>ETR</option>
    </select>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:2%'>-</div>
    <input type='text' id='VIEW_TYPE21_RID4'
      style='display:iniline-block;float:left;text-align:center;height:25px;width:10%'>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:30%'></div><br>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:100%'>요구사항</div><br>
    <textarea id='VIEW_TYPE21_TITLE' style='width:100%;height:60px'></textarea><BR>
    <div class='shade' style='display:iniline-block;float:left;text-align:center;height:25px;width:100%'>설명</div><br>
    <textarea id='VIEW_TYPE21_FLOEDIT'></textarea>
    <div style='float:left; border: 2px solid #48BAE4; width:700px; height: 2px;'></div><BR>
    <center> <button id='VIEW_TYPE21_SAVE' onclick='Save(21)'>Save</button> </center>
    <center> <button id='VIEW_TYPE21_REVIEW' onclick='Review(21)'>Review</button> </center>
  </div>

  <!-- STD REQ Item 31-->
  <div id='VIEW_TYPE31' class='RIGHT' hidden>
    <div id='VIEW_TYPE31_DOCUMENT' style='float: left'></div>
    <div style='float: left'>Requirement Item [ </div>
    <div id='VIEW_TYPE31_UID' style='float: left'></div> ]<br>
    <div> 요구사항식별자 : <div class='inline' id='VIEW_TYPE31_RID1'></div> -
      <select id='VIEW_TYPE31_RID2' style='vertical-align:middle;height:25px;'>
        <option value='SFR'>SFR</option>
        <option value='IDR'>IDR</option>
        <option value='SSR'>SSR</option>
        <option value='ECRR'>ECRR</option>
        <option value='SQR'>SQR</option>
        <option value='ETR'>ETR</option>
      </select> -
      <input type='text' id='VIEW_TYPE31_RID3' style='vertical-align:middle;width:100px;height:25px;'>
    </div>
    요구사항 :<textarea id='VIEW_TYPE31_TITLE' style='width:100%;height:30px'></textarea><BR>
    <div class='center' style='float:center; border: 2px solid #48BAE4; width:700px; height: 2px;'></div>
    <textarea id='VIEW_TYPE31_FLOEDIT'></textarea>
    <div style='float:left; border: 2px solid #48BAE4; width:700px; height: 2px;'></div><BR>
    <center> <button id='VIEW_TYPE31_SAVE' onclick='Save(31)'>Save</button> </center>
    <center> <button id='VIEW_TYPE31_REVIW' onclick='Review(31)'>Review</button> </center>
  </div>

  <script>
    const { ipcRenderer } = require('electron')
    var documents = ['SSS', 'SRS', 'STD', 'STR']
    var MileStone = ''
    var logbox = document.getElementById('LOG')
    var Authority = 0
    function Search() {
      doc = document.getElementById('DOCUMENT').value
      csci = document.getElementById('COMPONENT').value
      category = document.getElementById('CATEGORY').value
      text = document.getElementById('text').value
      jQuery.post('/Search', { search: [doc, csci, category, text] }, function (result) {
        list_L.loadData([])
        list_L.loadData(result)
        list_L.render()
        $('#SEARCH').hide()
      })
    }
    var modal = document.getElementById('SEARCH')
    window.onclick = function (event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }


    //Server Side Event 
    var progresscontinue = false
    var es = new EventSource('/event');
    es.onmessage = function (event) {
      log = JSON.parse(event.data)
      if (log.includes('[BroadCast]')) {
        ipcRenderer.send('Alert', log)
        return
      }
      if (log.includes('[ShutDown]')) {
        ipcRenderer.send('Alert', log)
        return
      }
      if (log.length > 50) {
        log = log.substring(0, 180) + " ..."
      }
      logbox.innerHTML = log
      if (log.includes('...')) {
        progresscontinue = true
      }
      else {
        progresscontinue = false
      }
    }

    setInterval(function () {
      if (progresscontinue) {
        logbox.innerHTML = logbox.innerHTML + "."
      }
    }, 1000)

    setInterval(function () {
      jQuery.post('/CheckConnection', { pass: 0 }, function (result) {
        console.log("pass")
      })
    }, 10000)
    function viewChange() {
      if (document.getElementById('VIEW_TYPE11_RID3').value !== 'SFR') {
        $('#VIEW_TYPE11_USECASE_LABEL').hide();
        $('#VIEW_TYPE11_USECASE').hide();
      }
      else {
        $('#VIEW_TYPE11_USECASE_LABEL').show();
        $('#VIEW_TYPE11_USECASE').show();
      }
    }

    function checkPermission(mode) {
      if (mode == 'EDIT') {
        Mode = 'VIEW'
        jQuery.post('/CheckPermission', { component: documentkind[1] }, function (result) {
          if (result === 'ok' && MileStone === 'current') {
            Authority = 1
            Mode = mode
            ModeChange()
            updateState()
          }
          else {
            Authority = 0
            logbox.innerHTML = 'Permission Not Allowed [EDIT Mode]'
            lastSelected = -1;
          }
        })
      }
      else if (mode == 'LINK') {
        lastSelected = -1;
        Mode = mode
        jQuery.post('/CheckPermission', { component: documentkind[1] }, function (result) {
          Authority = 1
          ModeChange()
          updateState()
          if (result === 'error' || MileStone !== 'current') {
            Authority = 0
            logbox.innerHTML = 'Permission Not Allowed [LINK Mode]'
          }
        })
      }
      else {
        Mode = mode
        ModeChange()
        updateState()
      }

    }
    // Mode Change Switch to Edit <-> Link
    var Mode = 'VIEW' //EDIT , SEARCH
    function ModeChange() {
      switch (documentkind[0]) {
        case 0: document.getElementById('LEFT_OVER').innerText = 'SSS'; break;
        case 1: document.getElementById('LEFT_OVER').innerText = 'SRS\n[' + configuration[documentkind[1]][0] + ']'; break;
        case 2: document.getElementById('LEFT_OVER').innerText = 'SDD\n[' + configuration[documentkind[1]][0] + ']'; break;
        case 3: document.getElementById('LEFT_OVER').innerText = 'STD\n[' + configuration[documentkind[1]][0] + ']'; break;
        case 4: document.getElementById('LEFT_OVER').innerText = 'STR\n[' + configuration[documentkind[1]][0] + ']'; break;
      }

      if (Mode === 'EDIT') {
        $('#RIGHT').hide();
        Select_Req(lastSelected)
        list_L.updateSettings(settings_L)
        filter = 'ALL'
        updateList_L(documentkind[0], documentkind[1], filter)
        document.getElementById('RIGHT_OVER').innerText = ''
        document.getElementById('FULL_OVER').innerText = ''
      }
      else if (Mode === 'VIEW') {
        $('#RIGHT').hide();
        Select_Req(lastSelected)
        list_L.updateSettings(settings_L)
        list_L.updateSettings({ contextMenu: false })
        filter = 'ALL'
        updateList_L(documentkind[0], documentkind[1], filter)
        document.getElementById('RIGHT_OVER').innerText = ''
        document.getElementById('FULL_OVER').innerText = ''

      }
      else if (Mode === 'LINK') {
        lastSelected = -1
        document.getElementById('FULL_OVER').innerText = '→\n'
        filter = 'Requirement Only'
        updateList_L(documentkind[0], documentkind[1], filter)
        if (documentkind[0] == 0) { updateList_R(1, -1, filter); document.getElementById('RIGHT_OVER').innerText = 'SRSs' } //SSS => ALL SRS
        else if (documentkind[0] == 1) { updateList_R(0, 0, filter); document.getElementById('RIGHT_OVER').innerText = 'SSS' } // SRS => SSS
        else { updateList_R(1, documentkind[1], filter); document.getElementById('RIGHT_OVER').innerText = 'SRS\n[' + configuration[documentkind[1]][0] + ']' } // STD/STR/STD => SRS
        list_L.updateSettings({ manualRowMove: false, contextMenu: false, colWidths: [15, 0.1, 40, 160, 0.1, 0.1,] })
        list_R.updateSettings({ contextMenu: false, colWidths: [15, 0.1, 40, 160, 0.1, 0.1,] })
        $('#RIGHT').show();
        $('#VIEW_TYPE0').hide();
        $('#VIEW_TYPE1').hide();
        $('#VIEW_TYPE11').hide();
        $('#VIEW_TYPE12').hide();
        $('#VIEW_TYPE2').hide();
        $('#VIEW_TYPE21').hide();
        $('#VIEW_TYPE3').hide();
        $('#VIEW_TYPE31').hide();
      }
      else {
        lastSelected = -1
        $('#SEARCH').show()
        $('#RIGHT').hide();
        $('#text').focus()
        Select_Req(-1)
        list_L.updateSettings(settings_L)
        list_L.updateSettings({ contextMenu: false })
        filter = 'ALL'
        updateList_L(-1, -1, filter)
        document.getElementById('LEFT_OVER').innerText = 'SEARCH'
        document.getElementById('RIGHT_OVER').innerText = ''
        document.getElementById('FULL_OVER').innerText = ''
      }
      //updateList_L(documentkind[0], documentkind[1], filter)
      Selected_Highlight()
      Selected_Highlight_R()
      updateState()
      resize_Window()
    }

    StateRenderer = function (instance, td, row, col, prop, value, cellProperties) {
      Handsontable.renderers.TextRenderer.apply(this, arguments);
      if (value !== 0) { instance.setCellMeta(row, 0, 'className', 'bold'); instance.setCellMeta(row, 1, 'className', 'bold'); instance.setCellMeta(row, 2, 'className', 'bold'); instance.setCellMeta(row, 3, 'className', 'bold'); }
    }

    function resize_Window() {
      list_L.updateSettings({ width: $('#LEFT').width(), height: $('#LEFT').height() })
      list_R.updateSettings({ width: $('#RIGHT').width(), height: $('#RIGHT').height() })
      list_L.render()
      list_R.render()
    }

    //  HandsOnTable Create with initial Data
    var lastSelected = -1
    var settings_L = {
      data: [],
      stretchH: 'all',
      colHeaders: ['uid', '장절', '식별자', '요구사항', 'seq', 'type', '√'], colWidths: [15, 30, 50, 160, 0.1, 0.1, 5],
      autoColumnSize: true, rowHeaders: true, manualRowMove: true,
      columns: [
        { type: 'text', readOnly: true },
        { type: 'text', readOnly: true },
        { type: 'text', readOnly: true },
        { type: 'text', readOnly: true },
        { type: 'text', readOnly: true, renderer: StateRenderer },
        { type: 'text', readOnly: true },
        { type: 'text', readOnly: true }
      ],
      afterDocumentKeyDown: function (event) { KeyEvent(event) },
      afterSelection: function (row) {
        if (Mode == 'EDIT' || Mode == 'VIEW' || Mode == 'SEARCH') { lastSelected = list_L.getData()[row][0]; Select_Req(lastSelected) }
        else { Selected_Highlight() }
      },
      //beforeRowMove: function (rows, target) { BeforeOrderChange(rows, target) },
      afterRowMove: function (rows, target) { AfterOrderChange(rows, target) },
      contextMenu: {//        callback: function (key, selection, clickEvent) {        },
        items: {
          'AddDocuItem': { name: '문서요소추가[D]', callback: function () { setTimeout(function () { AddItem(0); }, 0); } },
          'AddReq': { name: '요구사항추가[R]', callback: function () { setTimeout(function () { AddItem(1); }, 0); } },
          'AddUC': { name: 'UseCase 추가[U]', callback: function () { setTimeout(function () { AddItem(2); }, 0); } },
          'DelItem': { name: '아이템 삭제[Delete]', callback: function () { setTimeout(function () { DeleteItem(list_L.getSelected()) }, 0); } }
        }
      }
    }
    var settings_R = {
      data: [],
      stretchH: 'all',
      colHeaders: ['uid', '장절', '식별자', '요구사항', 'seq', 'type'], colWidths: [15, 30, 40, 160, 0.1, 0.1],
      autoColumnSize: true, rowHeaders: true,
      columns: [
        { type: 'text', readOnly: true },
        { type: 'text', readOnly: true },
        { type: 'text', readOnly: true },
        { type: 'text', readOnly: true },
        { type: 'text', readOnly: true, renderer: StateRenderer },
        { type: 'text', readOnly: true }
      ],
      afterDocumentKeyDown: function (event) { },
      afterSelection: function (row) { Selected_Highlight_R() },
      afterRowMove: function (rows, target) { orderChange(rows, target) }
    }


    function levelCounter(list) {
      var count = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
      var lastchapter = 0
      for (let row of list) {
        if (row[4] == 0 && row[1].length > 0) {
          var pos = (row[1].length / 2) - 1
          count[pos]++
          if (lastchapter > pos) {
            for (let c = pos + 1; c < count.length; c++) {
              count[c] = 0
            }
          }
          if (count[0] == 0) { count[0] = 1 }
          lastchapter = pos
          for(i =0;i<10;i++)
          {
            if(count[i]===0)
            {
              count[i]==1
            }
          }
          row[1] = count.slice(0, pos + 1).join('.')
        }
      }
    }

    list_L = new Handsontable(document.getElementById('List_Left'), settings_L);
    list_R = new Handsontable(document.getElementById('List_Right'), settings_R);

    function KeyEvent(event) {
      if (event.realTarget.id !== 'HandsontableCopyPaste') {
        return
      }

      if (Mode == 'EDIT') {
        switch (event.key) {
          case 'd':
          case 'D':
            AddItem(0)
            break
          case 'u':
          case 'U':
            AddItem(2)
            break
          case 'r':
          case 'R':
            AddItem(1)
            break
          case 'Delete':
            DeleteItem()
            break
        }
      }
      else if (Mode == 'LINK') {
        switch (event.key) {
          case 'l':
          case 'L':
            addLink('link')
            break;
          case 'u':
          case 'U':
            addLink('unlink')
            break;
          case 'e':
          case 'E':
            //popEdit(2)
            break;
          case 'Escape':
            Selected_Highlight(true)
            break
        }
      }
    }

    var Trace = []
    function updateList_L(document, csciid, filter) { //  List Request and Update
      //resize_Window()
      $('#LEFT').show();
      jQuery.post('/List', { document: document, component: csciid, filter: filter }, function (result) {
        levelCounter(result.data)
        list_L.loadData([])
        list_L.loadData(result.data)
        list_L.render()
        Trace = result.trace
      })
    }

    function updateList_R(document, csciid, filter) { //  List Request and Update
      //Selected_Highlight_R()
      jQuery.post('/List', { document: document, component: csciid, filter: filter }, function (result) {
        list_R.loadData(result.data)
        list_R.render()
      })
    }


    function Import(xlsx) {
      if (documentkind !== undefined) {
        jQuery.post('/Import', { document: documentkind[0], component: documentkind[1], xlsx: xlsx }, function (result) {
          if (result !== 'err') {
          }
        })
      }
    }

    function Export(type) {
      console.log(type)
      if (documentkind !== undefined) {
        jQuery.post('/Export', { document: documentkind[0], component: documentkind[1], type: type, filter: filter }, function (result) {
          if (result !== 'err') {
            Download(result)
          }
        })
      }
    }

    var Selected_L = new Set()
    var Selected_R = new Set()

    function Selected_Highlight(clear = false) {
      Selected_R.clear()
      Selected_L.clear()
      var selected = list_L.getSelected()
      if (clear == true) { selected = undefined }
      if (selected == undefined) { list_L.updateSettings({ cells: function (row, col) { return {} } }) }
      else {
        if (selected[0] > selected[2]) { [selected[0], selected[2]] = [selected[2], selected[0]] }
        var data = list_L.getData()
        list_L.updateSettings({
          cells: function (row, col) { var cellProperties = {}; if (selected[0] <= row && selected[2] >= row) { cellProperties.className = 'Selected'; Selected_L.add(data[row][0]); } return cellProperties; }
        })
      }
      linked_R = []
      for (let x of Selected_L) { for (let link of Trace) { if (link.link1 === x) { linked_R.push(link.link2) } if (link.link2 === x) { linked_R.push(link.link1) } } }
      var dataT = list_R.getData()
      list_R.updateSettings({ cells: function (row, col) { var cellProperties = {}; if (dataT.length > 0 && linked_R.includes(dataT[row][0])) { cellProperties.className = 'Linked'; }; return cellProperties; } })
      list_R.selectCell(linked_R.pop(), 2)
    }

    function Selected_Highlight_R() {
      Selected_R.clear()
      var selected = list_R.getSelected()
      if (selected == undefined) { list_R.updateSettings({ cells: function (row, col) { return {}; } }) }
      else {
        if (selected[0] > selected[2]) { [selected[0], selected[2]] = [selected[2], selected[0]] }
        var data = list_R.getData()
        list_R.updateSettings({
          cells: function (row, col) { var cellProperties = {}; if (selected[0] <= row && selected[2] >= row) { cellProperties.className = 'Selected'; Selected_R.add(data[row][0]) } return cellProperties; }
        })
      }
      if (Selected_L.size == 0) {
        linked_L = []
        for (let x of Selected_R) { for (let link of Trace) { if (link.link2 === x) { linked_L.push(link.link1) } if (link.link1 === x) { linked_L.push(link.link2) } } }
        var dataT = list_L.getData()
        list_L.updateSettings({ cells: function (row, col) { var cellProperties = {}; if (dataT.length > 0 && linked_L.includes(dataT[row][0])) { cellProperties.className = 'Linked'; }; return cellProperties; } })
        list_L.selectCell(linked_L.pop(), 2)
      }

    }
    function DOCID(document) { return '[' + documents[document.document] + ']' }
    function CSCIID(document) { return (document.component == 0 ? '' : configuration[document.component][0]) }
    function Select_Req(uid) { //  List Request and Update
      lastSelected = uid
      $('#VIEW_TYPE0').hide();
      $('#VIEW_TYPE1').hide();
      $('#VIEW_TYPE11').hide();
      $('#VIEW_TYPE12').hide();
      $('#VIEW_TYPE21').hide();
      $('#VIEW_TYPE31').hide();
      $('#VIEW_TYPE41').hide();
      if (Mode === 'LINK') { return }
      jQuery.post('/item', { uid: uid }, function (result) {
        switch (result.type) {
          case 0: //Document Item
            $('#VIEW_TYPE0').show();
            document.getElementById('VIEW_TYPE0_DOCUMENT').innerText = DOCID(result)
            document.getElementById('VIEW_TYPE0_CSCI').innerText = CSCIID(result)
            document.getElementById('VIEW_TYPE0_UID').innerText = result.uid
            document.getElementById('VIEW_TYPE0_RID1').value = result.identifier
            document.getElementById('VIEW_TYPE0_TITLE').value = result.title
            //$('#VIEW_TYPE0_FLOEDIT').froalaEditor({ height: 600, toolbarButtons: ['fullscreen', '|', 'align', 'insertTable', 'insertImage'], imageUploadURL: '/upload_image', imageManagerLoadURL: '/load_images', imageManagerPageSize: 20, imageManagerScrollOffset: 10, imageManagerDeleteURL: '/delete_image' })
            $('#VIEW_TYPE0_FLOEDIT').froalaEditor('html.set', result.description);

            if (Mode == 'VIEW') {
              $('#VIEW_TYPE0_RID1').prop('disabled', true);
              document.getElementById('VIEW_TYPE0_TITLE').readOnly = true;
              $('#VIEW_TYPE0_FLOEDIT').froalaEditor('edit.off')
              $('#VIEW_TYPE0_SAVE').hide()
              $('#VIEW_TYPE0_REVIEW').show()
            }
            else {
              $('#VIEW_TYPE0_RID1').prop('disabled', false);
              document.getElementById('VIEW_TYPE0_TITLE').readOnly = false;
              $('#VIEW_TYPE0_FLOEDIT').froalaEditor('edit.on')
              $('#VIEW_TYPE0_SAVE').show()
              $('#VIEW_TYPE0_REVIEW').hide()
            }
            break;

          case 1: //SSS REQUIREMENT Item
            $('#VIEW_TYPE1').show();
            document.getElementById('VIEW_TYPE1_DOCUMENT').innerText = DOCID(result)

            document.getElementById('VIEW_TYPE1_UID').innerText = result.uid
            var rid = result.identifier.split('-');
            document.getElementById('VIEW_TYPE1_RID1').innerHTML = rid[0] + '-' + rid[1];
            document.getElementById('VIEW_TYPE1_RID2').value = rid[2]
            document.getElementById('VIEW_TYPE1_TITLE').value = result.title;

            //$('#VIEW_TYPE1_FLOEDIT').froalaEditor({ height: 600, toolbarButtons: ['fullscreen', '|', 'align', 'insertTable', 'insertImage'], imageUploadURL: '/upload_image', imageManagerLoadURL: '/load_images', imageManagerPageSize: 20, imageManagerScrollOffset: 10, imageManagerDeleteURL: '/delete_image' })
            $('#VIEW_TYPE1_FLOEDIT').froalaEditor('html.set', result.description);


            if (Mode == 'VIEW') {
              $('#VIEW_TYPE1_RID1').prop('disabled', true);
              document.getElementById('VIEW_TYPE1_RID2').readOnly = true;
              document.getElementById('VIEW_TYPE1_TITLE').readOnly = true;
              $('#VIEW_TYPE1_FLOEDIT').froalaEditor('edit.off')
              $('#VIEW_TYPE1_SAVE').hide()
              $('#VIEW_TYPE1_REVIEW').show()
            }
            else {
              $('#VIEW_TYPE1_RID1').prop('disabled', false);
              document.getElementById('VIEW_TYPE1_RID2').readOnly = false;
              document.getElementById('VIEW_TYPE1_TITLE').readOnly = false;
              $('#VIEW_TYPE1_FLOEDIT').froalaEditor('edit.on')
              $('#VIEW_TYPE1_SAVE').show()
              $('#VIEW_TYPE1_REVIEW').hide()
            }
            break;

          case 11: //SRS Item
            $('#VIEW_TYPE11').show();

            document.getElementById('VIEW_TYPE11_DOCUMENT').innerText = DOCID(result)
            document.getElementById('VIEW_TYPE11_CSCI').innerText = CSCIID(result)

            document.getElementById('VIEW_TYPE11_UID').innerText = result.uid
            console.log(result.identifier)
            var rid = result.identifier.split('-');
            document.getElementById('VIEW_TYPE11_RID1').innerHTML = rid[0];
            document.getElementById('VIEW_TYPE11_RID2').innerHTML = rid[1];
            document.getElementById('VIEW_TYPE11_RID3').value = rid[2]
            document.getElementById('VIEW_TYPE11_RID4').value = rid[3]
            document.getElementById('VIEW_TYPE11_TESTTYPE').value = result.testtype;
            document.getElementById('VIEW_TYPE11_TITLE').value = result.title;
            document.getElementById('VIEW_TYPE11_SOURCE').value = result.src;

            if (rid[2] != 'SFR') {
              $('#VIEW_TYPE11_USECASE_LABEL').hide();
              $('#VIEW_TYPE11_USECASE').hide();
            }
            else {
              $('#VIEW_TYPE11_USECASE_LABEL').show();
              $('#VIEW_TYPE11_USECASE').show();
              document.getElementById('VIEW_TYPE11_USECASE').value = result.uc;
            }
            //$('#VIEW_TYPE11_FLOEDIT').froalaEditor({ height: 600, toolbarButtons: ['fullscreen', '|', 'align', 'insertTable', 'insertImage'], imageUploadURL: '/upload_image', imageManagerLoadURL: '/load_images', imageManagerPageSize: 20, imageManagerScrollOffset: 10, imageManagerDeleteURL: '/delete_image' })
            if (Mode == 'VIEW') {
              $('#VIEW_TYPE11_RID1').prop('disabled', true);
              $('#VIEW_TYPE11_RID2').prop('disabled', true);
              $('#VIEW_TYPE11_RID3').prop('disabled', true);
              $('#VIEW_TYPE11_RID4').prop('disabled', true);
              document.getElementById('VIEW_TYPE11_RID3').readOnly = true;
              $('#VIEW_TYPE11_TESTTYPE').prop('disabled', true);
              document.getElementById('VIEW_TYPE11_TITLE').readOnly = true;
              document.getElementById('VIEW_TYPE11_SOURCE').readOnly = true;
              document.getElementById('VIEW_TYPE11_USECASE').readOnly = true;
              $('#VIEW_TYPE11_FLOEDIT').froalaEditor('edit.off')
              $('#VIEW_TYPE11_SAVE').hide()
              $('#VIEW_TYPE11_REVIEW').show()
            }
            else {
              $('#VIEW_TYPE11_RID1').prop('disabled', false);
              $('#VIEW_TYPE11_RID2').prop('disabled', false);
              $('#VIEW_TYPE11_RID3').prop('disabled', false);
              $('#VIEW_TYPE11_RID4').prop('disabled', false);
              document.getElementById('VIEW_TYPE11_RID3').readOnly = false;
              $('#VIEW_TYPE11_TESTTYPE').prop('disabled', false);
              document.getElementById('VIEW_TYPE11_TITLE').readOnly = false;
              document.getElementById('VIEW_TYPE11_SOURCE').readOnly = false;
              document.getElementById('VIEW_TYPE11_USECASE').readOnly = false;
              $('#VIEW_TYPE11_FLOEDIT').froalaEditor('edit.on')
              $('#VIEW_TYPE11_SAVE').show()
              $('#VIEW_TYPE11_REVIEW').hide()
            }
            $('#VIEW_TYPE11_FLOEDIT').froalaEditor('html.set', result.description);

            break;
          case 12: //SRS Item
            $('#VIEW_TYPE12').show();

            document.getElementById('VIEW_TYPE12_DOCUMENT').innerText = DOCID(result)
            document.getElementById('VIEW_TYPE12_CSCI').innerText = CSCIID(result)

            document.getElementById('VIEW_TYPE12_UID').innerText = result.uid
            console.log(result.identifier)
            var rid = result.identifier.split('-');
            document.getElementById('VIEW_TYPE12_RID1').innerHTML = rid[0];
            document.getElementById('VIEW_TYPE12_RID2').innerHTML = rid[1];
            document.getElementById('VIEW_TYPE12_RID3').value = rid[2]
            document.getElementById('VIEW_TYPE12_RID4').value = rid[3]
            document.getElementById('VIEW_TYPE12_TITLE').value = result.title
            //$('#VIEW_TYPE12_FLOEDIT').froalaEditor({ height: 600, toolbarButtons: ['fullscreen', '|', 'align', 'insertTable', 'insertImage'], imageUploadURL: '/upload_image', imageManagerLoadURL: '/load_images', imageManagerPageSize: 20, imageManagerScrollOffset: 10, imageManagerDeleteURL: '/delete_image' })
            if (Mode == 'VIEW') {
              $('#VIEW_TYPE12_RID1').prop('disabled', true);
              $('#VIEW_TYPE12_RID2').prop('disabled', true);
              $('#VIEW_TYPE12_RID3').prop('disabled', true);
              $('#VIEW_TYPE12_RID4').prop('disabled', true);
              document.getElementById('VIEW_TYPE12_RID3').readOnly = true;
              $('#VIEW_TYPE12_FLOEDIT').froalaEditor('edit.off')
              $('#VIEW_TYPE12_SAVE').hide()
              $('#VIEW_TYPE12_REVIEW').show()
            }
            else {
              $('#VIEW_TYPE12_RID1').prop('disabled', false);
              $('#VIEW_TYPE12_RID2').prop('disabled', false);
              $('#VIEW_TYPE12_RID3').prop('disabled', false);
              $('#VIEW_TYPE12_RID4').prop('disabled', false);
              document.getElementById('VIEW_TYPE12_RID3').readOnly = false;
              $('#VIEW_TYPE12_FLOEDIT').froalaEditor('edit.on')
              $('#VIEW_TYPE12_SAVE').show()
              $('#VIEW_TYPE12_REVIEW').hide()
            }
            $('#VIEW_TYPE12_FLOEDIT').froalaEditor('html.set', result.description);

            break;
          case 21: //SDD Item
            $('#VIEW_TYPE21').show();
            document.getElementById('VIEW_TYPE21_DOCUMENT').innerText = DOCID(result)
            document.getElementById('VIEW_TYPE21_UID').innerText = result.uid
            var rid = result.identifier.split('-');
            document.getElementById('VIEW_TYPE21_RID1').innerHTML = rid[0];
            document.getElementById('VIEW_TYPE21_RID2').innerHTML = rid[1];
            document.getElementById('VIEW_TYPE21_RID3').value = rid[2];
            document.getElementById('VIEW_TYPE21_RID4').value = rid[3];
            document.getElementById('VIEW_TYPE21_TITLE').value = result.title;

            if (Mode == 'VIEW') {
              $('#VIEW_TYPE21_RID1').prop('disabled', true);
              $('#VIEW_TYPE21_RID2').prop('disabled', true);
              document.getElementById('VIEW_TYPE21_RID3').readOnly = true;
              document.getElementById('VIEW_TYPE21_RID4').readOnly = true;
              $('#VIEW_TYPE21_TESTTYPE').prop('disabled', true);
              document.getElementById('VIEW_TYPE21_TITLE').readOnly = true;
              $('#VIEW_TYPE21_FLOEDIT').froalaEditor('edit.off')
              $('#VIEW_TYPE21_SAVE').hide()
              $('#VIEW_TYPE21_REVIEW').show()
            }
            else {
              $('#VIEW_TYPE21_RID1').prop('disabled', false);
              $('#VIEW_TYPE21_RID2').prop('disabled', false);
              document.getElementById('VIEW_TYPE21_RID3').readOnly = false;
              document.getElementById('VIEW_TYPE21_RID4').readOnly = false;
              $('#VIEW_TYPE21_TESTTYPE').prop('disabled', false);
              document.getElementById('VIEW_TYPE21_TITLE').readOnly = false;
              $('#VIEW_TYPE21_FLOEDIT').froalaEditor('edit.on')
              $('#VIEW_TYPE21_SAVE').show()
              $('#VIEW_TYPE21_REVIEW').hide()
            }
            if (result.description == '') {
              $('#VIEW_TYPE21_FLOEDIT').froalaEditor('html.set', '<p>#활동다이어그램</p><p><img src="/uploads/TBD.png" style="width: 300px; " class="fr-fic fr-dib"></p><p style="text-align: center; ">그림# XXX 다이어그램</p><p>#시퀀스 다이어그램</p><p><img src="/uploads/TBD.png" style="width: 300px; " class="fr-fic fr-dib"></p><p style="text-align: center; ">그림# XXX 다이어그램</p><p>#간이클래스 다이어그램</p><p><img src="/uploads/TBD.png" style="width: 300px;" class="fr-fic fr-dib"></p><p style="text-align: center; ">그림# XXX 다이어그램</p>');
            }
            else {
              $('#VIEW_TYPE21_FLOEDIT').froalaEditor('html.set', result.description);
            }
            break;

          case 31: //STD Item
            $('#VIEW_TYPE31').show();
            document.getElementById('VIEW_TYPE31_DOCUMENT').innerText = DOCID(result)
            document.getElementById('VIEW_TYPE31_UID').innerText = result.uid
            var rid = result.identifier.split('-');
            document.getElementById('VIEW_TYPE31_RID1').innerHTML = rid[0] + '-' + rid[1];
            document.getElementById('VIEW_TYPE31_RID2').value = rid[2]
            document.getElementById('VIEW_TYPE31_RID3').value = rid[3]
            document.getElementById('VIEW_TYPE31_TITLE').value = result.title;

            if (Mode == 'VIEW') {
              $('#VIEW_TYPE31_RID1').prop('disabled', true);
              $('#VIEW_TYPE31_RID2').prop('disabled', true);
              document.getElementById('VIEW_TYPE31_RID3').readOnly = true;
              $('#VIEW_TYPE31_TESTTYPE').prop('disabled', true);
              document.getElementById('VIEW_TYPE31_TITLE').readOnly = true;
              $('#VIEW_TYPE31_FLOEDIT').froalaEditor('edit.off')
              $('#VIEW_TYPE31_SAVE').hide()
            }
            else {
              $('#VIEW_TYPE31_RID1').prop('disabled', false);
              $('#VIEW_TYPE31_RID2').prop('disabled', false);
              document.getElementById('VIEW_TYPE31_RID3').readOnly = false;
              $('#VIEW_TYPE31_TESTTYPE').prop('disabled', false);
              document.getElementById('VIEW_TYPE31_TITLE').readOnly = false;
              $('#VIEW_TYPE31_FLOEDIT').froalaEditor('edit.on')
              $('#VIEW_TYPE31_SAVE').show()
            }
            $('#VIEW_TYPE31_FLOEDIT').froalaEditor('html.set', result.description);

            break;
        }
      })
    }

    function addLink(type) {
      if (!Authority) { return }
      Link = {
        LinkOperation: type,
        type: parseInt(documentkind[0] + 10 * (documentkind[0] == 1 ? 0 : 1)),
        link1: Array.from(Selected_L),
        link2: Array.from(Selected_R)
      }
      if (documentkind[0] == 0) {
        Link.type = 1;
        Link.link1 = Array.from(Selected_R);
        Link.link2 = Array.from(Selected_L);
      }
      else if (documentkind[0] == 1) {
        Link.type = 1;
        Link.link1 = Array.from(Selected_L);
        Link.link2 = Array.from(Selected_R);
      }
      else if (documentkind[0] == 2) {
        Link.type = 2;
        Link.link1 = Array.from(Selected_L);
        Link.link2 = Array.from(Selected_R);
      }
      else if (documentkind[0] == 3) {
        Link.type = 3;
        Link.link1 = Array.from(Selected_L);
        Link.link2 = Array.from(Selected_R);
      }
      else if (documentkind[0] == 4) {
        Link.type = 4;
        Link.link1 = Array.from(Selected_L);
        Link.link2 = Array.from(Selected_R);
      }

      if (Link.link2.length > 0 && Link.link1.length > 0) {
        jQuery.post('/Link', Link, function (result) {
          updateList_L(documentkind[0], documentkind[1], filter)
          //updateList_R()
        })
      }

    }
    function AddItem(type) {
      if (!Authority) { return }
      var pos = 50000
      if (list_L.getSelected() !== undefined) {
        pos = list_L.getData()[list_L.getSelected()[0]][5]
      }
      if (type !== 0) {
        type = documentkind[0] * 10 + type
      }


      jQuery.post('/AddItem', { type: type, document: documentkind[0], component: documentkind[1], seq: pos - 0.5 }, function (result) {
        updateList_L(documentkind[0], documentkind[1], filter)
      })
    }

    function DeleteItem() {
      if (!Authority) { return }
      var selected = list_L.getSelected()
      var data = list_L.getData()
      var deleteitems = []
      if (selected[0] > selected[2]) { [selected[0], selected[2]] = [selected[2], selected[0]] }
      for (var r = selected[0]; r < selected[2] + 1; r++) { deleteitems.push(data[r][0]) }
      jQuery.post('/DeleteItems', { items: deleteitems }, function (result) { updateList_L(documentkind[0], documentkind[1], filter) })
      Select_Req(-1)
    }

    /*
    function BeforeOrderChange(rows, target) {
      var MovedOrder = []
      if (rows.length !== 0) {
        var data = list_L.getData()
        for (var r of rows) {
          MovedOrder.push(data[r][0])
        }
      }
      jQuery.post('/Align', { rows: MovedOrder, pos: target }, function (result) {
     
      })
    }*/

    function AfterOrderChange(rows, target) {
      var MovedOrder = []
      var data = list_L.getData()
      if (rows[0] > target) {//앞으로이동
        for (var c of Array(rows.length).keys()) { MovedOrder.push(data[target + c][0]) }
      }
      else { //뒤로 이동
        for (var c of Array(rows.length).keys()) { MovedOrder.push(data[target - rows.length + c][0]) }
      }
      jQuery.post('/Align', { rows: MovedOrder, pos: target }, function (result) { updateList_L(documentkind[0], documentkind[1], filter) })
    }
    function Review() {
      console.log(lastSelected)
      ipcRenderer.send('Review', lastSelected)
      
    }
    function ReviewConfirm() {
      console.log(lastSelected)
      ipcRenderer.send('ReviewConfirm', lastSelected)
    }


    function Save(type) {
      if (!Authority) { return }
      switch (type) {
        case 0://DESCRIPTION
          var context = {
            'type': type,
            'uid': document.getElementById('VIEW_TYPE0_UID').innerHTML,
            'identifier': document.getElementById('VIEW_TYPE0_RID1').value,
            'title': document.getElementById('VIEW_TYPE0_TITLE').value,
            'src': '',
            'uc': '',
            'description': document.getElementById('VIEW_TYPE0_FLOEDIT').value
          }
          break;

        case 1://SSS
          var context = {
            'type': type,
            'uid': document.getElementById('VIEW_TYPE1_UID').innerHTML,
            'identifier': document.getElementById('VIEW_TYPE1_RID1').innerText + '-' + document.getElementById('VIEW_TYPE1_RID2').value,
            'title': document.getElementById('VIEW_TYPE1_TITLE').value,
            'description': document.getElementById('VIEW_TYPE1_FLOEDIT').value
          }
          break;

        case 11://SRS
          if (document.getElementById('VIEW_TYPE11_USECASE_LABEL').style.display == 'none') {
            document.getElementById('VIEW_TYPE11_USECASE').value = ''
          }
          var context = {
            'type': type,
            'uid': document.getElementById('VIEW_TYPE11_UID').innerText,
            'identifier': document.getElementById('VIEW_TYPE11_RID1').innerText + '-' + document.getElementById('VIEW_TYPE11_RID2').innerText + '-' + document.getElementById('VIEW_TYPE11_RID3').value + '-' + document.getElementById('VIEW_TYPE11_RID4').value,
            'testtype': document.getElementById('VIEW_TYPE11_TESTTYPE').value,
            'title': document.getElementById('VIEW_TYPE11_TITLE').value,
            'src': document.getElementById('VIEW_TYPE11_SOURCE').value,
            'uc': document.getElementById('VIEW_TYPE11_USECASE').value,
            'description': document.getElementById('VIEW_TYPE11_FLOEDIT').value
          }
          break;

        case 12://SRS UC
          var context = {
            'type': type,
            'uid': document.getElementById('VIEW_TYPE12_UID').innerText,
            'identifier': document.getElementById('VIEW_TYPE12_RID1').innerText + '-' + document.getElementById('VIEW_TYPE12_RID2').innerText + '-' + document.getElementById('VIEW_TYPE12_RID3').value + '-' + document.getElementById('VIEW_TYPE12_RID4').value,
            'testtype': '',
            'title': document.getElementById('VIEW_TYPE12_TITLE').value,
            'src': '',
            'uc': '',
            'description': document.getElementById('VIEW_TYPE12_FLOEDIT').value
          }
          break;

        case 21:
          var context = {
            'type': type,
            'uid': document.getElementById('VIEW_TYPE21_UID').innerText,
            'identifier': document.getElementById('VIEW_TYPE21_RID1').innerText + '-' + document.getElementById('VIEW_TYPE21_RID2').innerText + '-' + document.getElementById('VIEW_TYPE21_RID3').value + '-' + document.getElementById('VIEW_TYPE21_RID4').value,
            'title': document.getElementById('VIEW_TYPE21_TITLE').value,
            'src': '',
            'uc': '',
            'description': document.getElementById('VIEW_TYPE21_FLOEDIT').value
          }
          break;

        case 31:
          var context = {
            'type': type,
            'uid': document.getElementById('VIEW_TYPE31_UID').innerText,
            'identifier': document.getElementById('VIEW_TYPE31_RID1').innerText + '-' + document.getElementById('VIEW_TYPE31_RID2').value + '-' + document.getElementById('VIEW_TYPE31_RID3').value,
            'title': document.getElementById('VIEW_TYPE31_TITLE').value,
            'src': '',
            'uc': '',
            'description': document.getElementById('VIEW_TYPE31_FLOEDIT').value
          }
          break;

      }
      jQuery.post('/Save', { context: context }, function (result) { updateList_L(documentkind[0], documentkind[1], filter) })
    }

    $(window).resize(function () { resize_Window() });
    var documentkind
    var configuration = {}
    var filter = 'all'
    var usersid = ""
    var current = ""
    window.addEventListener('DOMContentLoaded', function () {
      $('#LEFT').hide();
      $('#RIGHT').hide();
      $('#VIEW_TYPE0').hide();
      $('#VIEW_TYPE1').hide();
      $('#VIEW_TYPE11').hide();
      $('#VIEW_TYPE12').hide();
      $('#VIEW_TYPE21').hide();
      $('#VIEW_TYPE31').hide();
      resize_Window()

      jQuery.post('/configuration', function (result) {
        console.log(configuration)
        configuration = result[0]
        var options = '<option value=-1>All</option>'
        for (let item in configuration) { options += '<option value=' + item + '>' + configuration[item][0] + '</option>' }
        document.getElementById('COMPONENT').innerHTML = options
        ipcRenderer.send('Login', result)

        jQuery.post('/Start', function (result) {
          START(result)
        })
      })
      ipcRenderer.on('Home', (event, arg) => { jQuery.post('/Start', function (result) { START(result) }) })
      ipcRenderer.on('Export', (event, arg) => { Export(arg) })
      ipcRenderer.on('Import', (event, arg) => { Import(arg) })
      ipcRenderer.on('Mode', (event, arg) => { checkPermission(arg); ModeChange(); updateState(); })
      ipcRenderer.on('Filter', (event, arg) => { filter = arg; updateList_L(documentkind[0], documentkind[1], filter); updateState(); })
      ipcRenderer.on('SelectDoc', (event, arg) => {
        ipcRenderer.send('SelectDoc', arg)
        SelectDoc(arg)
      })
      list_L.updateSettings(settings_L)
    })
    function START(result) {
      
      $('#LEFT').hide();
      $('#RIGHT').hide();
      $('#VIEW_TYPE0').hide();
      $('#VIEW_TYPE1').hide();
      $('#VIEW_TYPE11').hide();
      $('#VIEW_TYPE12').hide();
      $('#VIEW_TYPE21').hide();
      $('#VIEW_TYPE31').hide();
      resize_Window()
      $('#START').show();
      MileStone = result['milestone']
      userid = result['userid']
      document.getElementById('USER').innerText = '[ ' + result['milestone'] + ' ][ ' + result['userid'] + ' ]'
      if (result.milestone !== 'current') {
        JOBS = '<H3>BaseLine ' + result.milestone.split("rm_")[1] + ' </H3>'
        document.getElementById('JOBS').innerHTML = JOBS
      }
      else {
        //document.getElementById('USER').innerText=result['userid']
        JOBS = '<H3>Documents...</H3>'
        for (let job of result['Jobs']) {
          JOBS += '<H4 style="padding-left: 100px; float:left;"> ' + job[1] + ' [</H4> <H4 style="vertical-align:bottom;float:left;" class="click"; onclick="SelectDoc([1,' + job[0] + '])">SRS, </H4><H4 style="float:left;" class="click"; onclick="SelectDoc([2,' + job[0] + '])">SDD, </H4><H4 style="float:left;" class="click"; onclick="SelectDoc([3,' + job[0] + '])">STD, </H4><H4 style="float:left;" class="click"; onclick="SelectDoc([4,' + job[0] + '])">STR, </H4><H4 style="float:left;" class="click"; onclick="SelectDoc([5,' + job[0] + '])">SPS </H4><H4 style="float:left">]</H4><br><br>'
        }
        document.getElementById('JOBS').innerHTML = JOBS
        var Logs = '<H3>Recent Document...</H3>'
        for (let log of result['Logs']) {
          if (log.length > 4) {
            Logs += '<H4 style="padding-left: 100px;" class="click" onclick="SelectDoc([' + log[4] + ',' + log[5] + ']);Select_Req(' + log[2] + ')">' + log[0] + ' ' + log[1] + ' ' + log[2] + (log[3] == null ? '' : '=>' + log[3]) + ' [' + documents[log[4]] + ']' + (log[4] == 0 ? '' : '[' + configuration[log[5]][0] + ']') + '[' + log[7] + '] ' + (log[6].length < 30 ? log[6] : log[6].substr(0, 50) + ' ...') + '</H4>'
          } else {
            Logs += '<H4 style="padding-left: 100px;">' + log[0] + '  ' + log[1] + ' ' + log[2] + '</H4>'
          }
        }
        document.getElementById('LAST').innerHTML = Logs
      }
    }
    function SelectDoc(arg) {
      lastSelected = -1
      ipcRenderer.send('SelectDoc', arg)
      $('#START').hide();
      documentkind = arg;
      updateList_L(documentkind[0], documentkind[1], filter);
      Mode = 'VIEW';
      ModeChange();
    }
    function updateState() {
      document.getElementById('MODESTATE').innerText = Mode + ' / ' + filter

      if (Mode === 'SEARCH') {
        document.getElementById('MODESTATE').innerText = 'SEARCH / -    '
      }
    }
    function Download(url) { document.getElementById('my_iframe').src = url; };

  </script>
  <script>if (typeof module === 'object') { window.module = module; module = undefined; }</script>
  <script type='text/javascript' src='/froala_editor/js/froala_editor.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/align.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/char_counter.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/code_beautifier.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/code_view.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/colors.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/draggable.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/emoticons.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/entities.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/file.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/font_size.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/font_family.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/fullscreen.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/image.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/image_manager.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/line_breaker.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/inline_style.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/link.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/lists.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/paragraph_format.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/paragraph_style.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/quick_insert.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/quote.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/table.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/save.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/url.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/video.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/help.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/print.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/special_characters.min.js'></script>
  <script type='text/javascript' src='/froala_editor/js/plugins/word_paste.min.js'></script>
  <script>
    $('#VIEW_TYPE0_FLOEDIT').froalaEditor({ height: 800, toolbarButtons: ['fullscreen', '|', 'align', 'insertTable', 'insertImage'], imageUploadURL: '/upload_image', imageManagerLoadURL: '/load_images', imageManagerPageSize: 20, imageManagerScrollOffset: 10, imageManagerDeleteURL: '/delete_image' })
    $('#VIEW_TYPE1_FLOEDIT').froalaEditor({ height: 600, toolbarButtons: ['fullscreen', '|', 'align', 'insertTable', 'insertImage'], imageUploadURL: '/upload_image', imageManagerLoadURL: '/load_images', imageManagerPageSize: 20, imageManagerScrollOffset: 10, imageManagerDeleteURL: '/delete_image' })
    $('#VIEW_TYPE11_FLOEDIT').froalaEditor({ height: 700, toolbarButtons: ['fullscreen', '|', 'align', 'insertTable', 'insertImage'], imageUploadURL: '/upload_image', imageManagerLoadURL: '/load_images', imageManagerPageSize: 20, imageManagerScrollOffset: 10, imageManagerDeleteURL: '/delete_image' })
    $('#VIEW_TYPE12_FLOEDIT').froalaEditor({ height: 700, toolbarButtons: ['fullscreen', '|', 'align', 'insertTable', 'insertImage'], imageUploadURL: '/upload_image', imageManagerLoadURL: '/load_images', imageManagerPageSize: 20, imageManagerScrollOffset: 10, imageManagerDeleteURL: '/delete_image' })
    $('#VIEW_TYPE21_FLOEDIT').froalaEditor({ height: 700, toolbarButtons: ['fullscreen', '|', 'align', 'insertTable', 'insertImage'], imageUploadURL: '/upload_image', imageManagerLoadURL: '/load_images', imageManagerPageSize: 20, imageManagerScrollOffset: 10, imageManagerDeleteURL: '/delete_image' })
    $('#VIEW_TYPE31_FLOEDIT').froalaEditor({ height: 900, toolbarButtons: ['fullscreen', '|', 'align', 'insertTable', 'insertImage'], imageUploadURL: '/upload_image', imageManagerLoadURL: '/load_images', imageManagerPageSize: 20, imageManagerScrollOffset: 10, imageManagerDeleteURL: '/delete_image' })
  </script>
  <script>if (window.module) module = window.module;</script>
  <iframe id='my_iframe' style='display:none;'></iframe>
</body>

</html>